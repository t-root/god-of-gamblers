<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Th·∫ßn B√†i - Ph√≤ng {{ room_id }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/game.css') }}">
</head>
<body>
    <div class="container">
        <header> 
            <p class="subtitle">Ph√≤ng: {{ room_id }}</p>
        </header>

        <div class="game-info">
            <div class="info-row">
                <div class="info-item">
                    <div class="info-label">T·ªâ l·ªá ho√°n b√†i</div>
                    <div class="info-value" id="boostChance">1%</div>
                </div>
                <div class="info-item">
                    <div class="info-label">L∆∞·ª£t ho√°n c√≤n l·∫°i</div>
                    <div class="info-value" id="swapsRemaining">3</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Ng∆∞·ªùi ch∆°i</div>
                    <div class="info-value" id="totalPlayers">0</div>
                </div>
            </div>
            <div class="info-row">
                <div class="info-item">
                    <div class="info-label">ƒê√£ √∫p b√†i</div>
                    <div class="info-value" id="foldedCount">0</div>
                </div>
                <div class="info-item">
                    <div class="info-label">S·∫µn s√†ng v√°n m·ªõi</div>
                    <div class="info-value" id="readyCount">0</div>
                </div>
            </div>
        </div>

        <div class="game-content">

        <div class="cards-container" id="cardsContainer">
            <!-- Cards will be generated here -->
        </div>

        <!-- Energy display hidden - only shown in swap overlay -->
        <div class="energy-container" style="display: none;">
            <div class="energy-label">
                <span>NƒÉng l∆∞·ª£ng ho√°n b√†i</span>
                <span id="energyPercent">0%</span>
            </div>
            <div class="energy-bar">
                <div class="energy-fill" id="energyFill"></div>
            </div>
            <div class="speed-display">T·ªëc ƒë·ªô ch√†: <span id="speedDisplay">0</span> pixel/gi√¢y</div>
            <div class="finger-count" id="fingerCount">Ng√≥n tay: 0/4</div>
        </div>

        <!-- Boost Info Popup Overlay -->
        <div class="boost-info-popup" id="boostInfo" style="display: none;">
            <div class="popup-overlay"></div>
            <div class="popup-content">
                <div class="popup-header">
                    <h3>üîÆ Ch·∫ø ƒë·ªô TƒÉng T·ªâ L·ªá</h3>
                    <button class="popup-close" id="closeBoostInfo">‚úï</button>
                </div>
                <div class="popup-body">
                    <div class="chant-display">
                        <div class="chant-bubble" id="chant1">1</div>
                        <div class="chant-bubble" id="chant2">2</div>
                        <div class="chant-bubble" id="chant3">3</div>
                    </div>
                    <p id="chantInstruction">N√≥i "nam m√¥ a di ƒë√† ph·∫≠t" ƒë·ªÉ tƒÉng t·ªâ l·ªá khi ho√°n b√†i...</p>
                    <div class="speech-display" id="speechDisplay" style="display: none;">
                        <div class="speech-text" id="speechText">...</div>
                        <button class="speech-ok-btn" id="speechOkBtn">OK</button>
                    </div>
                </div>
            </div>
        </div>
        </div>

        <div class="controls">
            <button class="control-btn" id="swapBtn" disabled>
                Ho√°n b√†i
            </button>
            <button class="control-btn" id="boostBtn">
                TƒÉng t·ªâ l·ªá
            </button>
            <button class="control-btn" id="revealCardsBtn">
                M·ªü b√†i
            </button>
            <button class="control-btn fold-btn" id="foldBtn">
                √öp b√†i
            </button>
            <button class="control-btn new-round-btn" id="newRoundTriggerBtn" style="display: none;">
                V√°n m·ªõi
            </button>
        </div>

        <div class="round-controls" id="roundControls" style="display: none;">
            <button class="control-btn new-round-btn" id="newRoundBtn">
                <span>üéØ</span> S·∫µn s√†ng m√†n m·ªõi
            </button>
            <div class="ready-status">
                <span>S·∫µn s√†ng: <span id="readyCount">0</span>/<span id="totalPlayers">1</span></span>
            </div>
        </div>


        <!-- Swap Overlay -->
        <div class="overlay" id="swapOverlay">
            <div class="cancel-container">
                <button class="cancel-btn" id="cancelOverlay">‚úï</button>
            </div> 

            <div class="overlay-energy">
                <div class="energy-bar">
                    <div class="energy-fill" id="overlayEnergyFill"></div>
                </div>
            </div>

            <!-- Selected Card Display -->
            <div class="selected-card-display" id="selectedCardDisplay">
                <div class="selected-card-large" id="selectedCardLarge">
                    <div class="card-value-large" id="selectedCardValue">--</div>
                    <div class="card-suit-large" id="selectedCardSuit">--</div>
                </div>
                <!-- OK button - shown after swap completes -->
                <div class="swap-completed" id="swapCompleted" style="display: none;">
                    <button class="swap-ok-btn" id="swapOkBtn">OK</button>
                </div>
            </div>

            <div class="touch-points">
                <div class="touch-point" id="touch1">1</div>
                <div class="touch-point" id="touch2">2</div>
                <div class="touch-point" id="touch3">3</div>
                <div class="touch-point" id="touch4">4</div>
            </div>

            
        </div>

        <!-- Card Selection Popup -->
        <div class="card-selection-overlay" id="cardSelectionOverlay">
            <div class="card-selection-popup">
                <h2 class="popup-title">CH·ªåN L√Å B√ÄI MONG MU·ªêN</h2>
                <p class="popup-description">Ch·ªçn l√° b√†i b·∫°n mu·ªën c√≥, sau ƒë√≥ n√≥i th·∫ßn ch√∫ ƒë·ªÉ tƒÉng t·ªâ l·ªá!</p>

                <div class="card-dropdowns">
                    <select class="card-dropdown" id="cardValueDropdown">
                        <option value="">Ch·ªçn gi√° tr·ªã...</option>
                        <option value="1">A</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                        <option value="10">10</option>
                        <option value="11">J</option>
                        <option value="12">Q</option>
                        <option value="13">K</option>
                    </select>
                </div>

                <div class="popup-buttons">
                    <button class="popup-btn cancel-btn" id="cancelCardSelection">H·ªßy</button>
                    <button class="popup-btn confirm-btn" id="confirmCardSelection" disabled>X√°c nh·∫≠n & Ho√°n b√†i</button>
                </div>
            </div>
        </div>


        <!-- New Round Waiting Popup -->
        <div class="new-round-popup" id="newRoundPopup" style="display: none;">
            <div class="popup-overlay"></div>
            <div class="popup-content">
                <div class="popup-header">
                    <h3>üéØ CH·ªú V√ÅN M·ªöI</h3>
                    <button class="popup-close" id="closeNewRoundPopup">‚úï</button>
                </div>
                <div class="popup-body">
                    <div class="waiting-animation">
                        <div class="spinner"></div>
                        <p>ƒêang ch·ªù ng∆∞·ªùi ch∆°i kh√°c...</p>
                    </div>
                    <div class="ready-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" id="readyProgressFill"></div>
                        </div>
                        <div class="progress-text">
                            <span id="readyProgressText">0/0 ng∆∞·ªùi ch∆°i ƒë√£ s·∫µn s√†ng</span>
                        </div>
                    </div>
                    <div class="ready-status-list" id="readyStatusList">
                        <!-- Player ready status will be added here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Deck Suggestion Popup -->
        <div class="deck-suggestion-popup" id="deckSuggestionPopup" style="display: none;">
            <div class="popup-overlay"></div>
            <div class="popup-content">
                <div class="popup-header">
                    <h3>‚ö†Ô∏è C·∫¢NH B√ÅO S·ªê L√Å B√ÄI</h3>
                </div>
                <div class="popup-body">
                    <div class="warning-icon">üé¥</div>
                    <p class="warning-text">
                        B·ªô b√†i hi·ªán t·∫°i ch·ªâ c√≤n <span id="remainingCardsCount">0</span> l√°.<br>
                        ƒêi·ªÅu n√†y c√≥ th·ªÉ l√†m gi·∫£m tr·∫£i nghi·ªám ch∆°i game do t·ªâ l·ªá ra l√° hi·∫øm kh√¥ng cao.
                    </p>
                    <p class="suggestion-text">
                        <strong>ƒê·ªÅ xu·∫•t:</strong> T·∫°o ph√≤ng m·ªõi v·ªõi th√™m 1 b·ªô b√†i (156 l√° t·ªïng c·ªông) ƒë·ªÉ c√≥ tr·∫£i nghi·ªám t·ªët h∆°n!
                    </p>
                </div>
                <div class="popup-buttons">
                    <button class="popup-btn cancel-btn" id="dismissDeckSuggestion">ƒê·ªÉ sau</button>
                    <button class="popup-btn secondary-btn" id="dontShowDeckSuggestion">Kh√¥ng nh·∫Øc l·∫°i</button>
                </div>
            </div>
        </div>

        <!-- Drag feedback -->
        <div class="drag-feedback hidden" id="dragFeedback">K√©o l√° b√†i ƒë·ªÉ ƒë·ªïi v·ªã tr√≠</div>

        <!-- Toast message -->
        <div class="toast" id="toast"></div>
    </div>

    <!-- Socket.IO -->
    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
    <script>
        // Room ID from template
        const ROOM_ID = '{{ room_id }}';

        // Device detection - show only mobile message for non-desktop users
        function isDesktop() {
            // Check for desktop indicators
            const userAgent = navigator.userAgent.toLowerCase();
            const isMobile = /android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(userAgent);
            const isTablet = /ipad|android(?!.*mobile)/i.test(userAgent);

            // Also check screen size - consider desktop if width > 1024px
            const isLargeScreen = window.innerWidth > 1024;

            // Consider it desktop if not mobile/tablet AND has large screen
            return !isMobile && !isTablet && isLargeScreen;
        }

        // Check device on page load
        document.addEventListener('DOMContentLoaded', function() {
            /*
            // Commented out: Lazy layout logic - will be used later
            if (!isDesktop()) {
                // Hide the game container and show only the mobile message
                const container = document.querySelector('.container');
                if (container) {
                    container.innerHTML = '<div style="display: flex; justify-content: center; align-items: center; height: 100vh; font-size: 24px; text-align: center; padding: 20px;">Game ƒë∆∞·ª£c t·ªëi ∆∞u cho thi·∫øt b·ªã di ƒë·ªông. Vui l√≤ng s·ª≠ d·ª•ng ƒëi·ªán tho·∫°i ƒë·ªÉ c√≥ tr·∫£i nghi·ªám t·ªët nh·∫•t! üì±</div>';
                }
                return; // Don't load the game
            }
            */

            // For desktop users, continue with normal game loading
            // The game.js script will be loaded below
        });
    </script>
    <script src="{{ url_for('static', filename='js/game.js') }}"></script>
</body>
</html>
